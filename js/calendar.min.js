var calendar;const peakBorder=35,calendarDateFrom="2021-01-01",calendarDateTo="2023-12-31";async function getDataAndDrawCalendar(){let e=new Date().getFullYear(),t=$("#area option:selected").val(),a=t+e;null!=sessionStorage.getItem(a)?drawCalendar(JSON.parse(sessionStorage.getItem(a))):await getJsonData(e,t).then(e=>{let t=createEvents(e);sessionStorage.setItem(a,JSON.stringify(t)),drawCalendar(t)},e=>{for(let t in e)e.warn?toastr.warning(e.warn):toastr.error(e.error)})}function getJsonData(e,t){return new Promise((a,n)=>{let o=t.substr(0,2),r=t.substr(2),i=`https://churageographic.github.io/data/${o}/${r}/${e}.json`;$.get(i,function(e){e.warn||e.error?n(e):a(e)},"json").fail(function(e){toastr.error(`「 ${$("#area option:selected").text()}の情報を取得できませんでした`)})})}function createEvents(e){let t=[];for(let a=0;a<e.length;a++){let n=e[a].l;if(n>=35)continue;let o=String(e[a].t).padStart(2,"0"),r=e[a].d+" "+o+":00",i={id:a+1,title:n+"cm",start:r,backgroundColor:getTidesColor(n)};t.push(i)}return t}function getTidesColor(e){return e<=0?"#ff1493":e<=15?"#ff8c00":e<=35?"#228b22":"#15A0C8"}function getCalendarHeight(){return window.innerHeight-100}function drawCalendar(e){calendar&&calendar.destroy(),calendar=new FullCalendar.Calendar(document.getElementById("calendar"),{height:getCalendarHeight(),windowResize:function(){calendar.setOption("height",getCalendarHeight())},locale:"ja",timeZone:"Asia/Tokyo",headerToolbar:{center:"title",right:"prevYear,prev,next,nextYear",left:"areaList dayGridMonth,listMonth,today"},buttonText:{today:"今日",month:"月",week:"週",day:"日",list:"一覧"},events:e,eventSources:[{url:"../data/holidays.json",display:"background",backgroundColor:"#ffccff"}],dayCellContent:function(e){return{html:e.dayNumberText.replace("日","")}},validRange:function(){return{start:"2021-01-01",end:"2023-12-31"}},customButtons:{areaList:{text:$("#area option:selected").text(),click:function(){$("#areaDialog").dialog({modal:!0,title:"エリア選択",closeOnEscape:!0,position:{my:"left top",at:"left top",of:".fc-view-harness"},open:function(e,t){$("#area").select2("open")}})}}}}).render()}function initToast(){toastr.options={positionClass:"toast-top-center",showDuration:"300",hideDuration:"300",timeOut:"3000"}}function initAreaList(){let e={沖縄:[{text:"我喜屋",value:"4701"},{text:"渡久地",value:"4704"},{text:"東",value:"4733"},{text:"石川",value:"4707"},{text:"那覇",value:"4705"},{text:"仲里",value:"4726"},{text:"平良",value:"4713"},{text:"長山",value:"4714"},{text:"石垣",value:"4715"},{text:"船越",value:"4737"},{text:"白浜",value:"4720"},{text:"比川",value:"4717"}]};var t=$("#area"),a=[];Object.keys(e).forEach(function(e,t){var n=$("<optgroup>").prop("label",e);Object.keys(this[e]).forEach(function(e,t){n.append($("<option>").text(this[e].text).val(this[e].value).prop("selected","4704"==this[e].value))},this[e]),a.push(n)},e),t.append(a),t.change(function(){$(".fc-areaList-button").text($("#area option:selected").text()),$("#areaDialog").dialog("close"),getDataAndDrawCalendar()}),$(document).ready(function(){t.select2()}),$(document).on("click",".ui-widget-overlay",function(){$(this).prev().find(".ui-dialog-content").dialog("close")})}$(document).ajaxStart(function(){$.LoadingOverlay("show",{image:"",maxSize:50,fontawesome:"fa fa-spinner fa-pulse",fontawesomeAnimation:"rotate_right",fontawesomeColor:"#15A0C8"})}),$(document).ajaxStop(function(){$.LoadingOverlay("hide")});const sleep=e=>new Promise(t=>setTimeout(t,e));$(function(){initToast(),initAreaList(),getDataAndDrawCalendar()});