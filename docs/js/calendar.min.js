'use strict';const peakBorder=35,calendarDateFrom="2021-01-01",calendarDateTo="2026-12-31";async function getDataAndDrawCalendar(){const c=(new Date).getFullYear(),b=$("#area option:selected").val(),d=b+c;null!=sessionStorage.getItem(d)?drawCalendar(JSON.parse(sessionStorage.getItem(d))):await getJsonData(c,b).then(a=>{a=createEvents(a);sessionStorage.setItem(d,JSON.stringify(a));drawCalendar(a)},a=>{for(let g in a)a.warn?toastr.warning(a.warn):toastr.error(a.error)})}
function getJsonData(c,b){return new Promise((d,a)=>{const g=b.substr(0,2),e=b.substr(2);var f=location.host?location.host:"churageographic.github.io";"churageographic.com"==f&&(f+="/tides");$.get(`https://${f}/data/${g}/${e}/${c}.json`,function(h){h.warn||h.error?a(h):d(h)},"json").fail(function(h){toastr.error(`\u300c ${$("#area option:selected").text()}\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f`)})})}
function createEvents(c){let b=[];for(let a=0;a<c.length;a++){var d=c[a].l;if(d>=peakBorder)continue;const g=String(c[a].t).padStart(2,"0");d={id:a+1,title:d+"cm",start:c[a].d+" "+g+":00",backgroundColor:getTidesColor(d)};b.push(d)}return b}function getTidesColor(c){return 0>=c?"#e8ff29":15>=c?"#8cffbd":c<=peakBorder?"#36aaf5":"#15A0C8"}function getCalendarHeight(){return window.innerHeight-100}var calendar,tmpY=(new Date).getFullYear();
function drawCalendar(c){calendar&&calendar.destroy();calendar=(new FullCalendar.Calendar(document.getElementById("calendar"),{height:getCalendarHeight(),windowResize:function(){calendar.setOption("height",getCalendarHeight())},locale:"ja",timeZone:"Asia/Tokyo",headerToolbar:{center:"title",right:"prevYear,prev,next,nextYear",left:"areaList dayGridMonth,listMonth,today"},buttonText:{today:"\u4eca\u65e5",month:"\u6708",week:"\u9031",day:"\u65e5",list:"\u4e00\u89a7"},events:c,eventSources:[{url:"../data/holidays.json",
display:"background",backgroundColor:"#ffccff"}],dayCellContent:function(b){return{html:b.dayNumberText.replace("\u65e5","")}},validRange:function(){return{start:calendarDateFrom,end:calendarDateTo}},customButtons:{areaList:{text:$("#area option:selected").text(),click:function(){$("#areaDialog").dialog({modal:!0,title:"\u30a8\u30ea\u30a2\u9078\u629e",closeOnEscape:!0,position:{my:"left top",at:"left top",of:".fc-view-harness"},open:function(b,d){$("#area").select2("open")}})}}},datesSet:async b=>
{let d=(new Date((b.start.getTime()+b.end.getTime())/2)).getFullYear();if(tmpY!=d){tmpY=d;const a=$("#area option:selected").val(),g=a+d;null==sessionStorage.getItem(g)&&await getJsonData(d,a).then(e=>{let f=createEvents(e);sessionStorage.setItem(g,null);b.view.calendar.batchRendering(function(){f.forEach(async h=>{await b.view.calendar.addEvent(h)})})},e=>{for(let f in e)e.warn?toastr.warning(e.warn):toastr.error(e.error)})}}})).render()}
function initToast(){toastr.options={positionClass:"toast-top-center",showDuration:"300",hideDuration:"300",timeOut:"3000"}}
function initAreaList(){const c={"\u6c96\u7e04":[{text:"\u6211\u559c\u5c4b",value:"4701"},{text:"\u6e21\u4e45\u5730",value:"4704"},{text:"\u6771",value:"4733"},{text:"\u77f3\u5ddd",value:"4707"},{text:"\u90a3\u8987",value:"4705"},{text:"\u4ef2\u91cc",value:"4726"},{text:"\u5e73\u826f",value:"4713"},{text:"\u9577\u5c71",value:"4714"},{text:"\u77f3\u57a3",value:"4715"},{text:"\u8239\u8d8a",value:"4737"},{text:"\u767d\u6d5c",value:"4720"},{text:"\u6bd4\u5ddd",value:"4717"}]};var b=$("#area"),d=[];Object.keys(c).forEach(function(a,
g){var e=$("<optgroup>").prop("label",a);Object.keys(this[a]).forEach(function(f,h){e.append($("<option>").text(this[f].text).val(this[f].value).prop("selected","4704"==this[f].value))},this[a]);d.push(e)},c);b.append(d);b.change(function(){$(".fc-areaList-button").text($("#area option:selected").text());$("#areaDialog").dialog("close");getDataAndDrawCalendar()});$(document).ready(function(){b.select2()});$(document).on("click",".ui-widget-overlay",function(){$(this).prev().find(".ui-dialog-content").dialog("close")})}
$(document).ajaxStart(function(){$.LoadingOverlay("show",{image:"",maxSize:50,fontawesome:"fa fa-spinner fa-pulse",fontawesomeAnimation:"rotate_right",fontawesomeColor:"#15A0C8"})});$(document).ajaxStop(function(){$.LoadingOverlay("hide")});const sleep=c=>new Promise(b=>setTimeout(b,c));$(function(){initToast();initAreaList();getDataAndDrawCalendar()});